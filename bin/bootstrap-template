#!/bin/sh -eux

run_template() {
  TEMPLATE=$1
  DEST=$2

  cat "template-files/$TEMPLATE" \
    | sed "s@\\\${project-name}\\\$@${ECOLOGY_PROJECT_NAME}@g" \
    | sed "s@\\\${project-description}\\\$@${ECOLOGY_PROJECT_DESCRIPTION}@g" \
    | tee "${DEST}"
}

run_template "README.md.template" "README.md"

envsubst '${ECOLOGY_DOCKER_BASE_IMAGE},${ECOLOGY_MAINTAINER_NAME},${ECOLOGY_MAINTAINER_EMAIL},${ECOLOGY_DOCKER_IMAGE_NAME_INTERNAL}' template-files/Dockerfile.template > Dockerfile

envsubst '${ECOLOGY_DOCKER_REPO}' template-files/Makefile.template > Makefile

envsubst '${ECOLOGY_DOCKER_REPO}' template-files/ci.template > bin/ci
